var ae=Object.defineProperty;var ie=(e,t,n)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var y=(e,t,n)=>(ie(e,typeof t!="symbol"?t+"":t,n),n);import{aA as le,ab as G,ad as M,cM as J,r as ce,a6 as D,d as T,bY as de,bW as ue,bB as me,bG as pe,a3 as E,aD as ge,bm as Q,b5 as N,t as $,i as I,b as _,a2 as w,a0 as v,a as L,j as R,c as k,er as K,a5 as he,es as be,bo as _e,a1 as W,a7 as U,bq as H,a4 as fe,cG as Ie,a9 as Ce}from"./index-kKS_qFVJ.js";import{I as P,S as Se}from"./iconTsx-V6kFKgYk.js";import{T as ve}from"./chatBackground-BWSbyUka.js";import{w as Ee,g as F,B as we,c as q,a as Le,s as Te,i as Ae}from"./appDialogsManager-Sa-0Kne-.js";import"./classNames-EpN7i9Yr.js";import"./page-DxDnEtK8.js";import"./avatar-DFwMY7KY.js";import"./putPreloader-MDqdeBQH.js";import"./htmlToSpan-DhAls8qz.js";import"./textToSvgURL-Cnw_Q8Rw.js";import"./fastBlur-Co-79rP4.js";import"./countryInputField-CQJ_NMlV.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./codeInputField-B6q2b2Ef.js";function Fe({name:e,component:t,observedAttributes:n=[],shadow:s=!1}){var i;if(customElements.get(e)){const a=customElements.get(e);return a.swapComponentFromHMR(t),a}const c=xe(e),m=(i=class extends HTMLElement{constructor(){super();y(this,"savedProps",(o=>({get element(){return o}}))(this));y(this,"controls",{});this.mountPoint=s?this.attachShadow({mode:"open"}):this}static swapComponentFromHMR(o){}static get observedAttributes(){return n}connectedCallback(){this.mount()}disconnectedCallback(){this.unmount()}attributeChangedCallback(o,r,l){this.attributesStore[o]=l}feedProps(o){this.disposeStores?Object.assign(this.propsStore,o):Object.assign(this.savedProps,o)}initStores(){le(o=>{this.disposeStores=o,this.propsStore=G(this.savedProps),this.attributesStore=G({}),M(()=>Object.keys(this.attributesStore).forEach(r=>{const l=r,g=this.attributesStore[l];this.getAttribute(l)!==this.attributesStore[l]&&(g==null?this.removeAttribute(l):this.setAttribute(l,g))}))})}mount(){let o;this.disposeStores&&(o=J(this.attributesStore)),this.unmount();const r=m.Component;this.initStores(),o&&Object.assign(this.attributesStore,o),this.disposeContent=ce(()=>{const l=this;return D(()=>r(l.propsStore,l.attributesStore,l.controls))},this.mountPoint)}unmount(){this.disposeContent?.(),this.disposeStores?.(),this.disposeStores=this.disposeContent=void 0,this.mountPoint.replaceChildren()}get[Symbol.toStringTag](){return c}},y(i,"Component",t),i);return customElements.define(e,m),m}function xe(e){return e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join("")}function ye(e,t){return ee(e.toLowerCase(),t.toLowerCase(),t.length)}function ee(e,t,n){let s=[],c=0;const m=e.length,i=t.length;for(let a=0;a<i;a++)for(let o=0;o<m;o++){if(e[o]!==t[a])continue;const{found:r}=ee(e.slice(o+1),t.slice(a+1),n),l=[o,...r.map(h=>h+o+1)],g=Y(e,t,l,n)-j.missing(n)*a;g>c&&(c=g,s=l)}return{found:s,score:Y(e,t,s,n)}}const j={missing:e=>1/e,gap:(e,t)=>.25/e*t};function Y(e,t,n,s,c){const m=e.length,i=t.length,a=n.length;if(!a)return 0;let o=1,r=0,l=-1;for(let g=0;g<a&&r<i;g++){const h=n[g];if(!(h<m))break;for(;e[h]!==t[r]&&r<i;)r++,o-=j.missing(s);r++,l!=-1&&h-l>1&&(o-=j.gap(i,h-l-1)),l=h}return o-=(s-r)*j.missing(s),o}const je="_Container_1oaje_36",Pe="_Scrollable_1oaje_43",Me="_ScrollableContainer_1oaje_52",De="_mobile_1oaje_58",ke="_Label_1oaje_62",He="_LabelText_1oaje_73",Ne="_Input_1oaje_81",Re="_EmptySearchTip_1oaje_92",Ze="_Char_1oaje_104",$e="_single_1oaje_112",Oe="_middle_1oaje_116",Be="_start_1oaje_120",ze="_end_1oaje_127",Ve="_Hidden_1oaje_135",Ge="_Item_1oaje_139",Ke="_selected_1oaje_139",We="_ItemLabel_1oaje_142",Ue="_ItemLabelText_1oaje_149",qe="_ItemLabelEnter_1oaje_152",Ye="_ItemIcon_1oaje_155",Xe="_ItemIconCheck_1oaje_158",Je="_AppearZoomEnterActive_1oaje_171",Qe="_AppearZoomEnter_1oaje_171",et="_AppearZoomExitTo_1oaje_174",d={Container:je,Scrollable:Pe,ScrollableContainer:Me,mobile:De,Label:ke,LabelText:He,Input:Ne,EmptySearchTip:Re,Char:Ze,single:$e,middle:Oe,start:Be,end:ze,Hidden:Ve,Item:Ge,selected:Ke,ItemLabel:We,ItemLabelText:Ue,ItemLabelEnter:qe,ItemIcon:Ye,ItemIconCheck:Xe,AppearZoomEnterActive:Je,AppearZoomEnter:Qe,AppearZoomExitTo:et},A=me("AddToFolderDropdownMenu",pe.Debug);async function yt(){return(await T.managers.filtersStorage.getDialogFilters()).filter(t=>t.id!==de&&t.id!==ue).sort((t,n)=>!t.id||!n.id?0:t?.localId-n?.localId)}const p=e=>Math.abs(e);async function tt(e,t){A.debug("addToFilter before",e),e={...e},e._==="dialogFilter"&&(e.excludePeerIds=e.excludePeerIds?.filter(s=>p(s)!==p(t)),e.exclude_peers=e.exclude_peers?.filter(s=>p(F(s))!==p(t))),e.pinnedPeerIds.find(s=>p(s)===p(t))||(e.includePeerIds=[...(e.includePeerIds||[]).filter(s=>p(s)!==p(t)),t],e.include_peers=[...(e.include_peers||[]).filter(s=>p(F(s))!==p(t)),await T.managers.appPeersManager.getInputPeerById(t)]),A.debug("addToFilter after",e),await T.managers.filtersStorage.updateDialogFilter(e)}async function nt(e,t){A.debug("removeFromFilter before",e),e={...e},e.includePeerIds=e.includePeerIds?.filter(n=>p(t)!==p(n)),e.include_peers=e.include_peers?.filter(n=>p(F(n))!==p(t)),e.pinnedPeerIds=e.pinnedPeerIds?.filter(n=>p(t)!==p(n)),e.pinned_peers=e.pinned_peers?.filter(n=>p(F(n))!==p(t)),e._==="dialogFilter"&&(e.excludePeerIds=[...(e.excludePeerIds||[]).filter(n=>p(n)!==p(t)),t],e.exclude_peers=[...(e.exclude_peers||[]).filter(n=>p(F(n))!==p(t)),await T.managers.appPeersManager.getInputPeerById(t)]),A.debug("removeFromFilter after",e),await T.managers.filtersStorage.updateDialogFilter(e)}function ot(e,t){const n=document.createElement("span"),s=Ee(e,t,!0);n.append(s);const c=document.createTreeWalker(n,NodeFilter.SHOW_TEXT),m=[],i=[];for(;c.nextNode();)m.push(c.currentNode);for(const a of m){const o=document.createDocumentFragment(),r=a.nodeValue.split("").map(l=>{const g=document.createElement("span");return g.innerText=l,g});i.push(r),o.append(...r),a.parentNode.replaceChild(o,a)}return{span:n,charSpansGroups:i}}function st(e,t){let n=0;const s=[];for(const c of e){const m=c.length,i=t.filter(o=>o>=n&&o<n+m).map(o=>o-n),a=i.length;n+=m;for(let o=0;o<a;o++){let r=o;for(;r<a-1&&i[r+1]-1===i[r];)r++;if(r===o){const h=i[o],C=c[h];C.classList.add(d.Char,d.single),s.push(C);continue}const l=c[i[o]],g=c[i[r]];l.classList.add(d.Char,d.start),g.classList.add(d.Char,d.end),s.push(l,g);for(let h=o+1;h<r;h++){const C=c[i[h]];C.classList.add(d.Char,d.middle),s.push(C)}o=r}}E(()=>{s.forEach(c=>{c.className=""})})}var Z=$("<span>");const rt=.25,at=({filter:e,isChecked:t})=>(()=>{var n=Z();return I(n,_(P,{get icon(){return Le(e)}}),null),I(n,_(ve,{get enterActiveClass(){return d.AppearZoomEnterActive},get exitActiveClass(){return d.AppearZoomEnterActive},get enterClass(){return d.AppearZoomEnter},get exitToClass(){return d.AppearZoomExitTo},get children(){return _(w,{get when(){return t()},get children(){var s=Z();return I(s,_(P,{icon:"check"})),v(()=>L(s,d.ItemIconCheck)),s}})}}),null),v(()=>L(n,`btn-menu-item-icon ${d.ItemIcon}`)),n})(),it=({label:e,isSelected:t})=>(()=>{var n=Z();return I(n,e,null),I(n,_(w,{get when(){return t()},get children(){return _(P,{icon:"enter",get class(){return d.ItemLabelEnter}})}}),null),v(()=>L(n,d.ItemLabel)),n})(),lt=({filters:e,isInFilter:t,isSelected:n,onToggle:s,currentFilter:c})=>D(()=>{const m=ge();return A.debug("creating folder items"),E(()=>{A.debug("destroying folder items middleware"),m.destroy()}),e().map(i=>{const{span:a,charSpansGroups:o}=ot(i.title,m.get());a.classList.add(d.ItemLabelText);const r={iconElement:at({filter:i,isChecked:()=>t(i)}),textElement:it({label:a,isSelected:()=>n(i.id)}),onClick:N},l=we(r);return r.element?.addEventListener(Q,async g=>{g.shiftKey&&c()!==i.id&&g.stopPropagation(),s(i)},!0),r.element?.classList.add(d.Item),M(()=>{n(i.id)&&(r.element?.classList.add(d.selected),E(()=>void r.element?.classList.remove(d.selected)))}),{filter:i,textContent:a.textContent,buttonMenuItem:l,element:r.element,charSpansGroups:o}})}),ct=({dialog:e,onNewDialog:t,isInFilter:n})=>{let s=!1;return async c=>{if(s||!c)return;const m=J(c);s=!0;try{await(n(c)?nt(m,e().peerId):tt(m,e().peerId));const i=await T.managers.dialogsStorage.getAnyDialog(e().peerId);if(!Ae(i))return;t(i)}catch{}finally{s=!1}}},dt=({folderItems:e,search:t,isSelected:n,setSelected:s})=>D(()=>{if(!t())return{folders:e(),visibleFoldersCount:e().length};const m=e().map(a=>({finderResult:ye(a.textContent,t()),src:a})).sort(({finderResult:{found:a,score:o}},{finderResult:{found:r,score:l}})=>o===l?(a[0]||0)-(r[0]||0):l-o);s(0),E(()=>void s());const i=m.filter(({src:a,finderResult:o})=>{if(o.score>=rt)return M(()=>{n(a.filter.id)&&a.element.scrollIntoView({block:"center"})}),st(a.charSpansGroups,o.found),!0;a.buttonMenuItem.forEach(r=>r.classList.add(d.Hidden)),E(()=>void a.buttonMenuItem.forEach(r=>r.classList.remove(d.Hidden)))}).length;return{folders:m.map(({src:a})=>a),visibleFoldersCount:i}}),ut=({pivot:e})=>{let t=N;return setTimeout(()=>{t=void 0},200),E(()=>{t?.()}),{showHint:()=>{t||(t=Te({element:e(),vertical:"top",textElement:R("AddToFolderTip"),lighter:!0,auto:!0,useOverlay:!1,onClose:()=>{t=void 0}}).close)},closeAndDisableTooltip:()=>{t?.(),t=N}}},mt=({search:e,setSearch:t,selected:n,setSelected:s,selectedFilter:c,currentFilter:m,onToggle:i,visibleFoldersCount:a})=>o=>{if(["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Enter"].includes(o.code)&&o.preventDefault(),o.code==="Escape"&&(e()?t(""):q.close()),o.code==="Enter"&&c()){i(c()),(!o.shiftKey||m()===c().id)&&q.close();return}if(typeof n()!="number")return;const r=["ArrowUp","ArrowLeft"].includes(o.code)?-1:["ArrowDown","ArrowRight"].includes(o.code)?1:0;s(l=>(l+r+a())%a())};var pt=$("<input>"),X=$("<div>");const gt=8,jt=Fe({name:"add-to-folder-dropdown-menu",component:(e,t,n)=>{e.element.classList.add("btn-menu",d.Container);let s,c,m;const[i,a]=k(""),[o,r]=k(),[l,g]=k([]),h=K(()=>e.dialog,(b,u)=>!!u?.[`index_${b.localId}`]),C=D(()=>l()[o()]?.filter),O=K(()=>C()?.id),B=ct({dialog:()=>e.dialog,onNewDialog:b=>{e.dialog=b,e.onNewDialog?.(b)},isInFilter:h}),te=lt({filters:()=>e.filters,isInFilter:h,isSelected:O,onToggle:B,currentFilter:e.currentFilter}),x=dt({folderItems:te,search:i,isSelected:O,setSelected:r}),{showHint:ne,closeAndDisableTooltip:oe}=ut({pivot:()=>s});n.closeTooltip=oe;const se=mt({search:i,setSearch:a,selected:o,setSelected:r,selectedFilter:C,currentFilter:e.currentFilter,onToggle:B,visibleFoldersCount:()=>x().visibleFoldersCount});he(()=>{m?.addEventListener(Q,b=>{b.stopPropagation()},!0)}),be(()=>{g(x().folders)}),M(()=>{typeof o()!="number"&&c?.scrollIntoView({block:"center"})});const re=_e.registerEscapeHandler(()=>!i());E(()=>{e.onCleanup?.(),re()});const z=()=>_(Ie,{get each(){return x().folders},children:b=>b.buttonMenuItem});return _(w,{get when(){return e.filters.length>gt},get fallback(){return _(z,{})},get children(){var b=X();return b.style.setProperty("--max-visible-items","6"),I(b,_(w,{when:!H,get children(){var u=pt();return W(f=>void setTimeout(()=>void f.focus(),100),u),U(u,"keydown",se,!0),u.addEventListener("blur",f=>{f.target.focus()}),u.$$input=f=>void a(f.target.value),v(()=>L(u,d.Input)),v(()=>u.value=i()),u}}),null),I(b,_(w,{get when(){return!x().visibleFoldersCount},get children(){return(()=>{const u=R("AddToFolderEmptySearchResult");return u.classList.add(d.EmptySearchTip),u})()}}),null),I(b,_(Se,{get class(){return d.Scrollable},thumbRef:u=>void(m=u),get children(){return[_(w,{when:!H,get children(){var u=X();U(u,"pointerenter",ne);var f=c;return typeof f=="function"?W(f,u):c=u,I(u,()=>{const S=R("AddToFolderSearch");return S.classList.add(d.LabelText),S},null),I(u,_(P,{ref(S){var V=s;typeof V=="function"?V(S):s=S},icon:"info"}),null),v(()=>L(u,d.Label)),u}}),_(z,{})]}}),null),v(u=>{var f=d.ScrollableContainer,S={[d.mobile]:H};return f!==u.e&&L(b,u.e=f),u.t=fe(b,S,u.t),u},{e:void 0,t:void 0}),b}})}});Ce(["input","keydown"]);export{jt as default,yt as fetchDialogFilters};
//# sourceMappingURL=index-D99Z67NK.js.map
